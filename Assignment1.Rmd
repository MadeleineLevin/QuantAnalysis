---
title: "Assignment 1"
author: "Madeleine Levin, Jaida Nabayan, Michael Zajakowski Uhll"
date: "10/21/2021"
output:
   html_document:
     theme: readable
     toc: true
     toc_depth: 3
     toc_float: true
---

```{r include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Research question

What is the relationship between the presence of open space and other amenities in NYC neighborhoods and the number of people arrested during protests against police brutality in summer 2020? 

# Prior research
While there is not a lot of quantitative research exploring the relationship between open space and protest in summer 2020, Rafail (2018) found that in NYC protests between 1960 and 2006, "the built
environment, and the social relationships creating it, powerfully influence where dissent occurs." Rafail finds that Privately Owned Public Spaces (POPs) are increasingly sites of gathering and protest, reflecting decentralization of public gathering spaces.Looking at the protests following George Floyd's death in 2020, The US Crisis Monitor collected data on the political demonstrations that took place during from May - August 2020, with substantial focus on BLM protests throughout the United States. Their maps show the spatial concentration of protests in urban centers and that the majority of gatherings were protests and not riots.

# Data

The sample population for this study is the entire citizen population of New York City in the summer of 2020. The analysis includes the following variables:

Variables

Continuous

* NYC Arrests for Summer 2020 for "Resisting Arrest"
* All NYC Arrests in Summer 2020
* Number of Parks
* Number of POPS
* Number of Libraries

Categorical

* NYC Borough of Arrest
* Does the Census Tract have a Subway Station


The arrest-level data was filtered down to "resisting arrest", an arrest description that often corresponds with protest activity. While not all arrests in this category can be tied to protests and not all protest arrests are in this category, we are using it here as a proxy for protest activity, the categories significantly filter down over 25,000 arrests over the summer months to 395 arrest rows that are more likely to be associated with protests. We used spatial processing tools to tie this data to NYC's 2,327 census tracts along with other neighborhood amenities including parks, POPS (Privately Operated Public Spaces), libraries, and subway stations.

Arrest Descriptions Used as Proxy for Protest Arrests:

* OFFENSES AGAINST PUBLIC ADMININISTRATION (RESISTING ARREST)

## Load data

```{r setup, warning = FALSE, message = FALSE, echo = FALSE, include=FALSE}
library(tidyverse)
library(tidycensus)
library(readxl)
library(knitr)
library(sf)
library(ggthemes)
library(ggspatial)
library(units)
library(nngeo)
library(geosphere)
```


* Bringing in New York Arrest and Amenities Data

```{r, include = FALSE}
arrestdata <-st_read("data/summer_NYC_resisting_arrest.geojson")
allarrests <-st_read("data/summer2020arrests.geojson")
```


```{r, include = FALSE}
POPs <-st_read("https://data.cityofnewyork.us/resource/rvih-nhyn.geojson")
libr <-st_read("data/Library.geojson")
parks <-st_read("data/Parks.geojson")
subway<-st_read("data/Subway.geojson")
```

* Bringing in Census Data
```{r, message = FALSE, include = FALSE}
census2020 <- get_decennial(geography = "tract",
                        year= 2020,
                        variables =c(pop= "P1_001N",
                                     race_pop = "P2_001N",
                                     latino = "P2_002N",
                                     white_alone = "P2_005N",
                                     black_alone = "P2_006N",
                                     native_alone = "P2_007N", 
                                     asian_alone = "P2_008N"),
                        state = "NY", county = c("Queens", "Kings", "Richmond","New York", "Bronx"),
              output = "wide",
                        geometry = TRUE)

```
* Putting in the State Plane
```{r, include = FALSE}
NY_state_plane <- "+proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666 +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs "
census2020 <-census2020 %>%
   st_transform(NY_state_plane)

arrestdata <-arrestdata %>%
   st_transform(NY_state_plane)

allarrests <- allarrests %>%
   st_transform(NY_state_plane)

POPs <-POPs %>%
   st_transform(NY_state_plane)

libr <-libr %>%
   st_transform(NY_state_plane)

parks <-parks %>%
   st_transform(NY_state_plane)

subway <-subway %>%
   st_transform(NY_state_plane)
```
* Aggregating the data to census tracts
```{r}
census2020 <- census2020 %>%
  mutate(num_arrests = lengths(st_covers(census2020, arrestdata)))

census2020 <- census2020 %>%
   mutate(allarrestssummer = lengths(st_covers(census2020, allarrests)))

census2020 <- census2020 %>%
  mutate(num_library = lengths(st_covers(census2020, libr)))

census2020 <- census2020 %>%
  mutate(num_POPs = lengths(st_covers(census2020, POPs)))

census2020 <- census2020 %>%
  mutate(num_parks = lengths(st_covers(census2020, parks)))

census2020 <- census2020 %>%
  mutate(num_subway = lengths(st_covers(census2020, subway)))

```

# Calculations

## Resisting Arrests between May and Sept 2020

```{r}
arrest_t_test <- t.test(census2020$num_arrests)

totalarrest_t_test <-t.test(census2020$allarrestssummer)
```

```{r}
arrest_quartiles <- quantile(census2020$num_arrests, na.rm = TRUE)
totalarrest_quartiles <- quantile(census2020$allarrestssummer, na.rm = TRUE)
```

```{r}
arrest_dev <- sd(census2020$num_arrests, na.rm = TRUE)
totalarrest_dev<- sd(census2020$allarrestssummer, na.rm = TRUE)
```


Resisting Arrests Histogram
```{r}
arrest_hist <- ggplot(census2020) +
  geom_histogram(aes(x = num_arrests),
                 bins = 30)

arrest_hist
```

Total Arrests Histogram
```{r}
totalarrest_hist <- ggplot(census2020) +
  geom_histogram(aes(x = allarrestssummer),
                 bins = 30)

totalarrest_hist
```
Table Comparing Arrests for Everything and Resisting Arrest
```{r}
cont_summary <- tibble(
  Variable = c("Median resisting arrests arrests per tract", 
               "Median total arrests per tract"),
  `Sample mean` = c(arrest_t_test$estimate,
                    totalarrest_t_test$estimate),
  `Population mean (95% confidence) - low` = 
    c(arrest_t_test$conf.int[1],
      totalarrest_t_test$conf.int[1]),
  `Population mean (95% confidence) - high` =
    c(arrest_t_test$conf.int[2],
      totalarrest_t_test$conf.int[2]),
  Median = c(arrest_quartiles[3],
             totalarrest_quartiles[3]),
  `Interquartile range` = c(arrest_quartiles[4] - arrest_quartiles[2],
                            totalarrest_quartiles[4] - totalarrest_quartiles[2]),
  `Standard deviation` = c(arrest_dev,
                         totalarrest_dev))
cont_summary
```

# Calculations

## Parks in NYC


```{r}
library_t_test <- t.test(census2020$num_library)

totallibrary_t_test <-t.test(census2020$num_library)
```

```{r}
libr_quartiles <- quantile(census2020$num_library, na.rm = TRUE)
totallibrary_quartiles <- quantile(census2020$num_library, na.rm = TRUE)
```

```{r}
libr_dev <- sd(census2020$num_library, na.rm = TRUE)
totallibr_dev<- sd(census2020$num_library, na.rm = TRUE)
```

```{r}
libr_hist <- ggplot(census2020) +
  geom_histogram(aes(x = num_library),
                 bins = 30)

library_hist
```

# Categorical Data
```{r}
pct_Queens<- t.test(arrestdata$arrest_boro == "Q")
pct_Queens
```


# References

Rafail, Patrick. “Protest in the City: Urban Spatial Restructuring and Dissent in New York, 1960–2006.” Urban Studies 55, no. 1 (January 2018): 244–60. https://doi.org/10.1177/0042098016661464.

Armed Conflict Location & Event Data Project (ACLED), The US Crisis Monitor, 2020 https://acleddata.com/acleddatanew/wp-content/uploads/2020/09/ACLED_USDataReview_Sum2020_SeptWebPDF_HiRes.pdf


