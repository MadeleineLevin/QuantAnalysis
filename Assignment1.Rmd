---
title: "Assignment 1"
author: "Madeleine Levin, Jaida Nabayan, Michael Zajakowski Uhll"
date: "10/21/2021"
output:
   html_document:
     theme: readable
     toc: true
     toc_depth: 3
     toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Research question

What is the relationship between the presence of open space and other amenities in NYC boroughs and the number of people arrested during protests against police brutality in summer 2020? 

# Prior research
While there is not a lot of quantitative research exploring the relationship between open space and protest in summer 2020, Rafail (2018) found that in NYC protests between 1960 and 2006, "the built
environment, and the social relationships creating it, powerfully influence where dissent occurs." Rafail finds that Privately Owned Public Spaces (POPs) are increasingly sites of gathering and protest, reflecting decentralization of public gathering spaces.Looking at the protests following George Floyd's death in 2020, The US Crisis Monitor collected data on the political demonstrations that took place during from May - August 2020, with substantial focus on BLM protests throughout the United States. Their maps show the spatial concentration of protests in urban centers and that the majority of gatherings were protests and not riots.

# Data

The sample population for this study is the entire citizen population of New York City in the summer of 2020. The analysis includes the following variables:

* NYC Arrests for Summer 2020
* Location of Public Spaces in New York
* NYC Borough Boundaries
* NYPD Sector Boundaries
* Libraries
* Privately Owned Public Spaces (POPs)
* Census 2020 Population by County
* Census 2020 Race by County

The arrest-level data was filtered down to arrest descriptions that correspond with protest activity. While not all arrests in each category can be tied to protests, the categories significantly filter down over 25,000 arrests over the summer months to 3,158 arrest rows that are more likely to be associated with protests. We can use the spatial categories (lat, long) to compare it with the locations of amenities (Wifi in Parks, POPs, and Libraries) which represent 1,243 rows (638 Wifi locations, 388 POPs, and 216 Libraries). 

Arrest Descriptions Used for Protest Arrests:

* CRIMINAL MISCHIEF & RELATED OF
* OFF. AGNST PUB ORD SENSBLTY &
* CRIMINAL TRESPASS
* NYS LAWS-UNCLASSIFIED FELONY
* OFFENSES AGAINST PUBLIC ADMININISTRATION (RESISTING ARREST)
* OFFENSES AGAINST PUBLIC SAFETY
* DISORDERLY CONDUCT

## Load data

```{r, message=FALSE}
library(tidyverse)
library(tidycensus)
library(readxl)
library(knitr)
library(sf)
library(ggthemes)
library(ggspatial)
library(units)
library(nngeo)
library(geosphere)
```

Bringing in New York Data
```{r, message=FALSE, results='hide'}
nyc_arrests <-read_csv(file = "data/NYC_Arrests_Summer2020.csv")
nyc_arrests1 <- read_csv("data/Summer2020.csv")
nyc_filteredarrests <-read_csv(file = "data/NYC_FilteredArrests.csv")
wifiparks <-read_csv(file ="data/WiFiPublicSpace.csv")
Boroughs <- read_csv(file ="data/NYCBoroughBoundaries.csv")
NYPDSectors <-read_csv(file = "data/NYPD_Sectors.csv")
library <-read_csv(file = "data/LIBRARY.csv")
POPs <-read_csv(file = "data/POPS.csv")
```


Calculating Distances
I need to fix the library dataset and break it down by lat/long
```{r}
mat <- distm(nyc_filteredarrests[,c('Longitude','Latitude')], wifiparks[,c('Longitude','Latitude')], fun=distVincentyEllipsoid)

nyc_filteredarrests$wifi_dist <- apply(mat, 1, min)

matpop <- distm(nyc_filteredarrests[,c('Longitude','Latitude')], POPs[,c('Longitude','Latitude')], fun=distVincentyEllipsoid)

nyc_filteredarrests$pops_dist <- apply(matpop, 1, min)
```


Bringing in Census Data
```{r, message=FALSE, results='hide'}
census2020 <- get_decennial(geography = "tract",
                        year= 2020,
                        variables =c(pop= "P1_001N",
                                     race_pop = "P1_002N"),
                        state = "NY", county = c("Queens", "Kings", "Richmond","New York", "Bronx"),
              output = "wide",
                        geometry = TRUE)
```

```{r}
NY_state_plane <- "+proj=lcc +lat_1=41.03333333333333 +lat_2=40.66666666666666 +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000.0000000001 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs "
census2020 <-census2020 %>%
   st_transform(NY_state_plane)

```

# Calculations

```{r}
wifi_t_test <- t.test(nyc_filteredarrests$wifi_dist)
wifi_t_test
```

```{r}
wifi_quartiles <- quantile(nyc_filteredarrests$wifi_dist, na.rm = TRUE)
wifi_quartiles
```

```{r}
wifi_st_dev <- sd(nyc_filteredarrests$wifi_dist, na.rm = TRUE)
wifi_st_dev
```

```{r}
covid_hist <- ggplot(nyc_filteredarrests) +
  geom_histogram(aes(x = wifi_dist),
                 bins = 300)

covid_hist
```
# Categorical Data

```{r}
pct_female <- t.test(nyc_filteredarrests$PERP_SEX == "F")
pct_female
pct_male <-  t.test(nyc_filteredarrests$PERP_SEX == "M")
pct_male
```

```{r}
cat_summary_sex <- tibble(`Sex` = 
                              c("Female",
                                "Male"),
                            `Sample proportion` = 
                              c(pct_female$estimate * 100,
                                pct_female$estimate *100),
                            `95-percent confidence - low` = 
                              c(pct_female$conf.int[1] * 100,
                                pct_male$conf.int[1] * 100),
                            `95-percent confidence - high` = 
                              c(pct_female$conf.int[2] * 100,
                                pct_male$conf.int[2] * 100))

kable(cat_summary_sex, digits = 0)
```



# References

Rafail, Patrick. “Protest in the City: Urban Spatial Restructuring and Dissent in New York, 1960–2006.” Urban Studies 55, no. 1 (January 2018): 244–60. https://doi.org/10.1177/0042098016661464.

Armed Conflict Location & Event Data Project (ACLED), The US Crisis Monitor, 2020 https://acleddata.com/acleddatanew/wp-content/uploads/2020/09/ACLED_USDataReview_Sum2020_SeptWebPDF_HiRes.pdf


